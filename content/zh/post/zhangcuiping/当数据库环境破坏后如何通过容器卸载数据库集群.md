+++

title = "当数据库环境破坏后如何通过容器卸载数据库集群" 

date = "2023-07-13" 

tags = ["当数据库环境破坏后如何通过容器卸载数据库集群"] 

archives = "2023-07" 

author = "张翠娉" 

summary = "当数据库环境破坏后如何通过容器卸载数据库集群"

img = "/zh/post/zhangcuiping/title/img.png" 

times = "14:20"

+++

# 当数据库环境破坏后如何通过容器卸载数据库集群？

**背景介绍**：

在使用MogDB Manager进行数据库主备安装时，由于在机器上误删了数据库目录文件，导致无法在MogDB Manager网页界面通过点击删除图标删除数据库节点。

**报错内容**：

```bash
rpc error:code= Code(14051)desc=清理元数据失败
```

**报错原因：**

由于在机器上误删了数据库目录文件，所以MogDB Manager界面上无法删除。

**说明**：MogDB Manager上的删除集群只是在MogDB Manager的数据库里把集群删了，实际集群是没有卸载的，如果需要卸载的话，需要到容器里去卸载。

**解决办法**：

1. 登录部署集群的主机。

2. 执行如下命令查询服务名，找到mogdbmanager_v122_amd64-mog-dbm-svc-1。

   ```
   docker ps | grep dbm
   ```

3. 进入容器

   ```
   docker exec -it mogdbmanager_v122_amd64-mog-dbm-svc-1 sh
   ```

4. 查看已经安装的集群。

   ```
   ptk ls
   ```

5. 执行如下命令停止集群。

   ```
   ptk cluster stop -n clusterName
   ```

6. 执行如下命令卸载集群。

   ```
   ptk uninstall -n clusterName
   ```

7. 容器中完成卸载后，登录MogDB Manager网页界面，点击删除，此时可成功删除集群。